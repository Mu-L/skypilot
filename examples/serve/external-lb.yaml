# SkyServe YAML to run multiple Load Balancers in different region.
#
# Usage:
#   1. Register the hosted zone in Route53.
#   2. Go to your DNS manager and setup name servers to Route53.
#   3. `sky serve up examples/serve/external-lb.yaml`.

name: multi-lb

service:
  readiness_probe:
    path: /health
    initial_delay_seconds: 20
  replicas: 6
  # TODO(tian): Change the config to a cloud-agnostic way.
  route53_hosted_zone: aws.cblmemo.net
  external_load_balancers:
    - resources:
        cloud: aws
        region: us-east-2
      load_balancing_policy: round_robin
    - resources:
        cloud: aws
        region: ap-northeast-1
      load_balancing_policy: round_robin

resources:
  cloud: aws
  any_of:
    - region: us-east-2
    - region: ap-northeast-1
  ports: 8080
  cpus: 2+

workdir: examples/serve/http_server

run: python3 server.py
